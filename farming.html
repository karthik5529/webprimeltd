
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pocket Empire Builder</title>
  <style>
    /* Reset and Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Arial', sans-serif;
    }
    
    :root {
      --primary: #9b87f5;
--primary-light: #b8a8f8;
--primary-dark: #7E69AB;
--dark: #1A1F2C;
--light: #F1F0FB;
--success: #4CAF50;
--warning: #FFC107;
--danger: #F44336;
--info: #2196F3;
--transition-speed: 0.3s;
}

body {
background-color: var(--light);
color: var(--dark);
min-height: 100vh;
display: flex;
flex-direction: column;
overflow-x: hidden;
}

/* Layout Containers */
.container {
width: 100%;
max-width: 1200px;
margin: 0 auto;
padding: 1rem;
}

.game-container {
display: flex;
flex-direction: column;
gap: 1rem;
animation: fadeIn 0.5s ease-out;
}

/* Header Styles */
header {
background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
color: white;
padding: 1rem;
text-align: center;
box-shadow: 0 4px 12px rgba(0,0,0,0.1);
position: relative;
overflow: hidden;
}

header:before {
content: '';
position: absolute;
top: -50%;
left: -50%;
width: 200%;
height: 200%;
background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
animation: headerShine 8s linear infinite;
}

@keyframes headerShine {
0% {
  transform: rotate(0deg);
}
100% {
  transform: rotate(360deg);
}
}

h1 {
font-size: 1.8rem;
margin-bottom: 0.5rem;
position: relative;
display: inline-block;
text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
}

h1:after {
content: '';
position: absolute;
bottom: -5px;
left: 25%;
width: 50%;
height: 3px;
background: white;
border-radius: 2px;
transform: scaleX(0);
transform-origin: center;
animation: underlineAnimation 2s ease-in-out infinite;
}

@keyframes underlineAnimation {
0%, 100% { transform: scaleX(0); }
50% { transform: scaleX(1); }
}

/* Resource Bar */
.resource-bar {
display: flex;
justify-content: space-around;
background: linear-gradient(180deg, #ffffff 0%, #f9f9f9 100%);
padding: 0.75rem;
border-radius: 12px;
box-shadow: 0 4px 15px rgba(0,0,0,0.05);
flex-wrap: wrap;
transition: transform var(--transition-speed), box-shadow var(--transition-speed);
}

.resource-bar:hover {
transform: translateY(-2px);
box-shadow: 0 6px 20px rgba(0,0,0,0.08);
}

.resource {
display: flex;
flex-direction: column;
align-items: center;
padding: 0.5rem;
min-width: 80px;
position: relative;
transition: transform var(--transition-speed);
}

.resource:hover {
transform: scale(1.05);
}

.resource:after {
content: '';
position: absolute;
bottom: 0;
left: 10%;
width: 80%;
height: 2px;
background: var(--primary);
border-radius: 1px;
transform: scaleX(0);
transition: transform 0.3s ease;
transform-origin: center;
}

.resource:hover:after {
transform: scaleX(1);
}

.resource-icon {
font-size: 1.5rem;
margin-bottom: 0.25rem;
transition: transform 0.3s ease;
}

.resource:hover .resource-icon {
transform: scale(1.2) rotate(5deg);
}

.resource-label {
font-size: 0.75rem;
color: #666;
transition: color 0.3s ease;
}

.resource:hover .resource-label {
color: var(--primary-dark);
}

.resource-value {
font-weight: bold;
font-size: 1.1rem;
transition: all 0.2s ease;
}

.resource-value.updated {
animation: valueUpdate 0.5s ease;
}

@keyframes valueUpdate {
0% { transform: scale(1); color: var(--primary); }
50% { transform: scale(1.2); color: var(--primary); }
100% { transform: scale(1); }
}

/* Grid System */
.grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
gap: 1rem;
}

/* Card Component */
.card {
background-color: white;
border-radius: 12px;
box-shadow: 0 4px 15px rgba(0,0,0,0.05);
overflow: hidden;
transition: transform var(--transition-speed), box-shadow var(--transition-speed);
position: relative;
}

.card:hover {
transform: translateY(-4px);
box-shadow: 0 8px 25px rgba(0,0,0,0.1);
}

.card-header {
background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
color: white;
padding: 0.75rem 1.25rem;
font-weight: bold;
position: relative;
overflow: hidden;
}

.card-header:before {
content: '';
position: absolute;
top: -50%;
left: -50%;
width: 200%;
height: 200%;
background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
opacity: 0;
transition: opacity 0.5s ease;
}

.card:hover .card-header:before {
opacity: 1;
animation: cardHeaderShine 2s linear;
}

@keyframes cardHeaderShine {
0% { transform: translateX(-100%) rotate(45deg); }
100% { transform: translateX(100%) rotate(45deg); }
}

.card-body {
padding: 1.25rem;
}

/* Button Styles */
.btn {
display: inline-block;
padding: 0.5rem 1.25rem;
background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
color: white;
border: none;
border-radius: 8px;
cursor: pointer;
font-size: 0.9rem;
transition: all 0.2s, transform 0.1s;
text-align: center;
position: relative;
overflow: hidden;
box-shadow: 0 4px 10px rgba(126, 105, 171, 0.3);
}

.btn:before {
content: '';
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0) 100%);
transform: translateX(-100%);
}

.btn:hover {
background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary) 100%);
box-shadow: 0 6px 15px rgba(126, 105, 171, 0.4);
}

.btn:hover:before {
animation: btnShine 1s;
}

@keyframes btnShine {
0% { transform: translateX(-100%); }
100% { transform: translateX(100%); }
}

.btn:active {
transform: scale(0.97);
box-shadow: 0 2px 5px rgba(126, 105, 171, 0.2);
}

.btn-block {
display: block;
width: 100%;
}

.btn-disabled {
background: linear-gradient(135deg, #cccccc 0%, #aaaaaa 100%);
cursor: not-allowed;
box-shadow: none;
}

.btn-disabled:hover {
background: linear-gradient(135deg, #cccccc 0%, #aaaaaa 100%);
box-shadow: none;
}

/* Progress Bars */
.progress-container {
background-color: #eef1f6;
border-radius: 8px;
height: 10px;
overflow: hidden;
margin: 0.5rem 0;
position: relative;
box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
}

.progress-bar {
height: 100%;
background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%);
width: 0%;
transition: width 0.5s ease;
border-radius: 8px;
position: relative;
box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.progress-bar:after {
content: '';
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0) 100%);
animation: progressShine 2s linear infinite;
border-radius: 8px;
}

@keyframes progressShine {
0% { transform: translateX(-100%); }
100% { transform: translateX(100%); }
}

/* Building Items */
.building-item {
margin-bottom: 1.25rem;
padding-bottom: 1.25rem;
border-bottom: 1px solid #eee;
transition: all 0.3s ease;
}

.building-item:hover {
transform: translateX(5px);
border-bottom-color: var(--primary-light);
padding-left: 5px;
}

.building-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 0.75rem;
}

.building-title {
font-weight: bold;
font-size: 1.1rem;
position: relative;
display: inline-block;
transition: color 0.3s ease;
}

.building-item:hover .building-title {
color: var(--primary-dark);
}

.building-level {
background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
color: white;
padding: 0.25rem 0.75rem;
border-radius: 20px;
font-size: 0.8rem;
box-shadow: 0 2px 5px rgba(0,0,0,0.1);
transition: all 0.3s ease;
}

.building-item:hover .building-level {
transform: scale(1.05);
box-shadow: 0 3px 8px rgba(0,0,0,0.15);
}

.building-description {
font-size: 0.9rem;
margin-bottom: 0.75rem;
color: #666;
line-height: 1.4;
}

.building-production {
font-size: 0.9rem;
color: var(--success);
margin-bottom: 0.75rem;
font-weight: 500;
display: flex;
align-items: center;
}

.building-production:before {
content: '‚ûï';
margin-right: 5px;
font-size: 0.8rem;
}

.building-cost {
display: flex;
gap: 0.75rem;
font-size: 0.85rem;
color: #666;
margin-bottom: 0.75rem;
align-items: center;
}

.cost-item {
display: flex;
align-items: center;
gap: 0.25rem;
padding: 4px 8px;
background-color: #f9f9f9;
border-radius: 6px;
transition: all 0.3s ease;
}

.building-item:hover .cost-item {
background-color: #f0f0f0;
}

/* Tabs */
.tabs {
display: flex;
background-color: white;
border-radius: 12px 12px 0 0;
overflow: hidden;
box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
position: relative;
z-index: 1;
}

.tab {
flex: 1;
padding: 0.85rem;
text-align: center;
cursor: pointer;
background-color: #f5f5f5;
transition: all 0.3s ease;
position: relative;
overflow: hidden;
font-weight: 500;
}

.tab:before {
content: '';
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 4px;
background: var(--primary);
transform: translateY(-4px);
transition: transform 0.3s ease;
}

.tab:hover:before {
transform: translateY(0);
}

.tab:after {
content: '';
position: absolute;
bottom: 0;
left: 10%;
width: 80%;
height: 2px;
background: var(--primary-dark);
transform: scaleX(0);
transition: transform 0.3s ease;
transform-origin: center;
}

.tab:hover:after {
transform: scaleX(1);
}

.tab.active {
background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
color: white;
font-weight: 600;
box-shadow: 0 4px 12px rgba(126, 105, 171, 0.3);
transform: translateY(-2px);
}

.tab.active:before, .tab.active:after {
display: none;
}

.tab-content {
display: none;
animation: fadeIn 0.3s ease-out;
}

.tab-content.active {
display: block;
}

/* Notifications */
#notification-container {
position: fixed;
bottom: 20px;
right: 20px;
z-index: 1000;
display: flex;
flex-direction: column-reverse;
gap: 10px;
}

.notification {
background-color: white;
border-left: 4px solid var(--primary);
padding: 1rem;
border-radius: 8px;
box-shadow: 0 4px 15px rgba(0,0,0,0.15);
transform: translateX(120%);
transition: transform 0.3s cubic-bezier(.17,.67,.83,.67);
display: flex;
justify-content: space-between;
min-width: 250px;
position: relative;
overflow: hidden;
}

.notification:before {
content: '';
position: absolute;
top: 0;
left: 0;
width: 4px;
height: 100%;
opacity: 0.7;
animation: notificationPulse 2s infinite;
}

@keyframes notificationPulse {
0% { opacity: 0.7; }
50% { opacity: 1; }
100% { opacity: 0.7; }
}

.notification.show {
transform: translateX(0);
}

.notification.success {
border-left-color: var(--success);
}

.notification.success:before {
background-color: var(--success);
}

.notification.warning {
border-left-color: var(--warning);
}

.notification.warning:before {
background-color: var(--warning);
}

.notification.error {
border-left-color: var(--danger);
}

.notification.error:before {
background-color: var(--danger);
}

.notification.info {
border-left-color: var(--info);
}

.notification.info:before {
background-color: var(--info);
}

.notification-close {
background: none;
border: none;
font-size: 1.2rem;
line-height: 1;
cursor: pointer;
color: #999;
transition: color 0.2s, transform 0.2s;
}

.notification-close:hover {
color: #333;
transform: scale(1.1);
}

/* Achievements */
.achievement {
display: flex;
align-items: center;
gap: 1rem;
padding: 1rem;
border-radius: 8px;
background-color: rgba(155, 135, 245, 0.05);
margin-bottom: 0.75rem;
transition: all 0.3s ease;
position: relative;
overflow: hidden;
}

.achievement:hover {
background-color: rgba(155, 135, 245, 0.1);
transform: translateY(-2px);
box-shadow: 0 4px 12px rgba(0,0,0,0.05);
}

.achievement:before {
content: '';
position: absolute;
top: 0;
left: 0;
right: 0;
bottom: 0;
background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0) 100%);
transform: translateX(-100%);
}

.achievement:hover:before {
animation: achievementShine 1.5s;
}

@keyframes achievementShine {
0% { transform: translateX(-100%); }
100% { transform: translateX(100%); }
}

.achievement-icon {
font-size: 1.8rem;
color: var(--primary);
transition: all 0.3s ease;
display: flex;
align-items: center;
justify-content: center;
width: 40px;
height: 40px;
border-radius: 50%;
background-color: rgba(155, 135, 245, 0.1);
}

.achievement:hover .achievement-icon {
transform: scale(1.1) rotate(5deg);
background-color: rgba(155, 135, 245, 0.2);
}

.achievement-info {
flex: 1;
}

.achievement-title {
font-weight: bold;
margin-bottom: 3px;
transition: color 0.3s ease;
}

.achievement:hover .achievement-title {
color: var(--primary-dark);
}

.achievement-desc {
font-size: 0.85rem;
color: #666;
line-height: 1.3;
}

.achievement-progress {
text-align: right;
transition: all 0.3s ease;
}

.achievement.completed {
background-color: rgba(76, 175, 80, 0.05);
}

.achievement.completed:hover {
background-color: rgba(76, 175, 80, 0.1);
}

.achievement.completed .achievement-icon {
color: var(--success);
background-color: rgba(76, 175, 80, 0.1);
}

.achievement.completed:hover .achievement-icon {
background-color: rgba(76, 175, 80, 0.2);
}

.claim-reward {
padding: 5px 10px;
font-size: 0.85rem;
background: linear-gradient(135deg, #4CAF50 0%, #3d8b40 100%);
box-shadow: 0 3px 8px rgba(76, 175, 80, 0.3);
}

.claim-reward:hover {
background: linear-gradient(135deg, #5cb860 0%, #4CAF50 100%);
box-shadow: 0 4px 10px rgba(76, 175, 80, 0.4);
}

/* Responsive Design */
@media (max-width: 768px) {
.grid {
  grid-template-columns: 1fr;
}

.resource-bar {
  flex-wrap: wrap;
  justify-content: space-between;
}

.resource {
  min-width: 60px;
  padding: 0.25rem;
}

.building-header {
  flex-direction: column;
  align-items: flex-start;
}

.building-level {
  margin-top: 0.25rem;
}

.notification {
  min-width: auto;
  width: 85vw;
}
}

/* Animations */
@keyframes pulse {
0% { transform: scale(1); }
50% { transform: scale(1.05); }
100% { transform: scale(1); }
}

@keyframes fadeIn {
from { opacity: 0; transform: translateY(10px); }
to { opacity: 1; transform: translateY(0); }
}

@keyframes slideIn {
from { transform: translateY(20px); opacity: 0; }
to { transform: translateY(0); opacity: 1; }
}

@keyframes scaleIn {
from { transform: scale(0.9); opacity: 0; }
to { transform: scale(1); opacity: 1; }
}

.pulse {
animation: pulse 0.5s ease;
}

.fade-in {
animation: fadeIn 0.3s ease-out;
}

.slide-in {
animation: slideIn 0.3s ease-out;
}

.scale-in {
animation: scaleIn 0.3s ease-out;
}

/* Modal */
.modal-overlay {
position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;
background-color: rgba(0,0,0,0.6);
z-index: 100;
display: none;
align-items: center;
justify-content: center;
animation: fadeIn 0.3s;
backdrop-filter: blur(3px);
}

.modal {
background-color: white;
border-radius: 12px;
width: 90%;
max-width: 500px;
max-height: 90vh;
overflow-y: auto;
box-shadow: 0 10px 30px rgba(0,0,0,0.2);
animation: scaleIn 0.3s;
}

.modal-header {
display: flex;
justify-content: space-between;
align-items: center;
padding: 1.25rem;
border-bottom: 1px solid #eee;
background: linear-gradient(135deg, #f9f9f9 0%, #f5f5f5 100%);
border-radius: 12px 12px 0 0;
}

.modal-title {
font-weight: bold;
font-size: 1.3rem;
color: var(--primary-dark);
}

.modal-close {
background: none;
border: none;
font-size: 1.5rem;
cursor: pointer;
color: #777;
transition: all 0.2s;
width: 30px;
height: 30px;
display: flex;
align-items: center;
justify-content: center;
border-radius: 50%;
}

.modal-close:hover {
background-color: rgba(0,0,0,0.05);
color: #333;
transform: rotate(90deg);
}

.modal-body {
padding: 1.25rem;
}

.modal-footer {
padding: 1.25rem;
border-top: 1px solid #eee;
display: flex;
justify-content: flex-end;
gap: 0.75rem;
background: linear-gradient(135deg, #f9f9f9 0%, #f5f5f5 100%);
border-radius: 0 0 12px 12px;
}

/* Game specific elements */
.plot-grid {
display: grid;
grid-template-columns: repeat(3, 1fr);
gap: 0.75rem;
margin-top: 1rem;
}

.plot {
aspect-ratio: 1/1;
background: linear-gradient(135deg, #8E5E3F 0%, #7E4E2F 100%);
border-radius: 8px;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
color: white;
position: relative;
overflow: hidden;
transition: all 0.3s ease;
box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

.plot:before {
content: '';
position: absolute;
top: 0;
left: 0;
right: 0;
height: 40%;
background: linear-gradient(to bottom, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 100%);
z-index: 1;
}

.plot.empty {
background: linear-gradient(135deg, #8E5E3F 0%, #7E4E2F 100%);
}

.plot.empty:hover {
transform: scale(1.03);
box-shadow: 0 6px 15px rgba(142, 94, 63, 0.3);
}

.plot.planted {
background: linear-gradient(135deg, #4CAF50 0%, #3d8b40 100%);
}

.plot.planted:hover {
transform: translateY(-3px);
box-shadow: 0 6px 15px rgba(76, 175, 80, 0.3);
}

.plot.ready {
background: linear-gradient(135deg, #CDDC39 0%, #AFB42B 100%);
animation: readyPulse 1.5s infinite;
}

@keyframes readyPulse {
0% { transform: scale(1); box-shadow: 0 4px 10px rgba(205, 220, 57, 0.3); }
50% { transform: scale(1.05); box-shadow: 0 6px 18px rgba(205, 220, 57, 0.5); }
100% { transform: scale(1); box-shadow: 0 4px 10px rgba(205, 220, 57, 0.3); }
}

.plot-overlay {
position: absolute;
top: 0;
left: 0;
right: 0;
bottom: 0;
display: flex;
align-items: center;
justify-content: center;
background-color: rgba(0,0,0,0.5);
opacity: 0;
transition: opacity 0.3s;
border-radius: 8px;
z-index: 2;
}

.plot:hover .plot-overlay {
opacity: 1;
}

.plot-overlay span {
background-color: rgba(0,0,0,0.6);
padding: 5px 12px;
border-radius: 20px;
font-size: 0.85rem;
font-weight: 500;
transform: translateY(10px);
transition: transform 0.3s ease;
}

.plot:hover .plot-overlay span {
transform: translateY(0);
}

/* Tooltip */
.tooltip {
position: relative;
display: inline-block;
}

.tooltip-text {
visibility: hidden;
background-color: #333;
color: white;
text-align: center;
padding: 8px 12px;
border-radius: 6px;
position: absolute;
z-index: 10;
bottom: 125%;
left: 50%;
transform: translateX(-50%) scale(0.9);
opacity: 0;
transition: opacity 0.3s, transform 0.3s;
font-size: 0.85rem;
white-space: nowrap;
box-shadow: 0 3px 10px rgba(0,0,0,0.2);
pointer-events: none;
}

.tooltip-text:after {
content: '';
position: absolute;
top: 100%;
left: 50%;
margin-left: -5px;
border-width: 5px;
border-style: solid;
border-color: #333 transparent transparent transparent;
}

.tooltip:hover .tooltip-text {
visibility: visible;
opacity: 1;
transform: translateX(-50%) scale(1);
}

/* Particle Effects */
.confetti-container {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
pointer-events: none;
z-index: 1000;
overflow: hidden;
}

.confetti {
position: absolute;
width: 10px;
height: 10px;
background-color: #f00;
opacity: 0;
animation: confettiFall 3s ease-out forwards;
transform-origin: center;
}

@keyframes confettiFall {
0% {
  opacity: 1;
  transform: translateY(-10px) rotate(0deg);
}
100% {
  opacity: 0;
  transform: translateY(100vh) rotate(720deg);
}
}

/* Sound Toggle */
.sound-toggle {
position: fixed;
top: 20px;
right: 20px;
width: 36px;
height: 36px;
background-color: rgba(255, 255, 255, 0.8);
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
z-index: 100;
box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
transition: all 0.3s ease;
}

.sound-toggle:hover {
transform: scale(1.1);
background-color: white;
box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.sound-toggle span {
font-size: 1.2rem;
}

.sound-toggle.muted span:after {
content: '‚ùå';
position: absolute;
font-size: 0.8rem;
bottom: -2px;
right: -2px;
}
</style>
</head>
<body>
<header>
<h1>Pocket Empire Builder</h1>
<p>Build your own farming empire!</p>
</header>

<main class="container game-container">
<section class="resource-bar">
<div class="resource">
  <div class="resource-icon">üí∞</div>
  <div class="resource-label">Gold</div>
  <div class="resource-value" id="gold-value">0</div>
</div>
<div class="resource">
  <div class="resource-icon">üåæ</div>
  <div class="resource-label">Crops</div>
  <div class="resource-value" id="crops-value">0</div>
</div>
<div class="resource">
  <div class="resource-icon">‚ö°</div>
  <div class="resource-label">Energy</div>
  <div class="resource-value" id="energy-value">10/10</div>
</div>
<div class="resource">
  <div class="resource-icon">üìà</div>
  <div class="resource-label">Level</div>
  <div class="resource-value" id="level-value">1</div>
</div>
</section>

<section class="tabs-container">
<div class="tabs">
  <div class="tab active" data-tab="farm">Farm</div>
  <div class="tab" data-tab="buildings">Buildings</div>
  <div class="tab" data-tab="market">Market</div>
  <div class="tab" data-tab="achievements">Achievements</div>
</div>

<div id="farm" class="tab-content active">
  <div class="card">
    <div class="card-header">Your Farm</div>
    <div class="card-body">
      <p>Plant crops, wait for them to grow, and harvest them for profit!</p>
      <div class="plot-grid" id="farm-plots">
        <!-- Farm plots will be generated here -->
      </div>
    </div>
  </div>
  
  <div class="card" style="margin-top: 1rem;">
    <div class="card-header">Seeds</div>
    <div class="card-body" id="seeds-container">
      <!-- Seeds will be generated here -->
    </div>
  </div>
</div>

<div id="buildings" class="tab-content">
  <div class="card">
    <div class="card-header">Buildings</div>
    <div class="card-body">
      <p>Upgrade buildings to increase production and unlock new features.</p>
      <div id="buildings-container">
        <!-- Buildings will be generated here -->
      </div>
    </div>
  </div>
</div>

<div id="market" class="tab-content">
  <div class="card">
    <div class="card-header">Market</div>
    <div class="card-body">
      <p>Sell your crops for gold!</p>
      <div id="market-container">
        <!-- Market items will be generated here -->
      </div>
    </div>
  </div>
</div>

<div id="achievements" class="tab-content">
  <div class="card">
    <div class="card-header">Achievements</div>
    <div class="card-body">
      <p>Complete achievements to earn rewards!</p>
      <div id="achievements-container">
        <!-- Achievements will be generated here -->
      </div>
    </div>
  </div>
</div>
</section>
</main>

<div id="notification-container"></div>
<div id="confetti-container" class="confetti-container"></div>

<div class="sound-toggle" id="sound-toggle">
<span>üîä</span>
</div>

<div class="modal-overlay" id="modal">
<div class="modal">
<div class="modal-header">
  <div class="modal-title" id="modal-title">Modal Title</div>
  <button class="modal-close" id="modal-close">&times;</button>
</div>
<div class="modal-body" id="modal-body">
  <!-- Modal content will be inserted here -->
</div>
<div class="modal-footer">
  <button class="btn" id="modal-cancel">Cancel</button>
  <button class="btn" id="modal-confirm">Confirm</button>
</div>
</div>
</div>

<script>
// Game State and Constants
const SAVE_KEY = 'pocket-empire-game';
const AUTO_SAVE_INTERVAL = 60000; // Save every minute
const ENERGY_REGEN_TIME = 300000; // 5 minutes per energy

const SEED_TYPES = {
corn: {
  name: 'Corn',
  icon: 'üåΩ',
  cost: 10,
  growthTime: 60000, // 1 minute for testing (normally longer)
  yield: 3,
  xp: 5,
  unlockLevel: 1
},
carrot: {
  name: 'Carrot',
  icon: 'ü•ï',
  cost: 20,
  growthTime: 120000, // 2 minutes
  yield: 7,
  xp: 10,
  unlockLevel: 2
},
wheat: {
  name: 'Wheat',
  icon: 'üåæ',
  cost: 50,
  growthTime: 180000, // 3 minutes
  yield: 15,
  xp: 20,
  unlockLevel: 3
},
tomato: {
  name: 'Tomato',
  icon: 'üçÖ',
  cost: 100,
  growthTime: 240000, // 4 minutes
  yield: 30,
  xp: 40,
  unlockLevel: 5
},
strawberry: {
  name: 'Strawberry',
  icon: 'üçì',
  cost: 200,
  growthTime: 300000, // 5 minutes
  yield: 60,
  xp: 80,
  unlockLevel: 8
}
};

const BUILDINGS = {
silo: {
  name: 'Silo',
  description: 'Increases crop storage capacity',
  icon: 'üè¢',
  maxLevel: 5,
  baseCost: 100,
  unlockLevel: 1,
  effect: (level) => `Storage: +${level * 50} crops`
},
barn: {
  name: 'Barn',
  description: 'Generates crops over time',
  icon: 'üèöÔ∏è',
  maxLevel: 5,
  baseCost: 200,
  unlockLevel: 3,
  effect: (level) => `Production: +${level} crop/min`
},
well: {
  name: 'Well',
  description: 'Increases maximum energy',
  icon: '‚õ≤',
  maxLevel: 5,
  baseCost: 150,
  unlockLevel: 2,
  effect: (level) => `Energy: +${level * 2} max`
},
windmill: {
  name: 'Windmill',
  description: 'Increases crop selling prices',
  icon: 'üè≠',
  maxLevel: 5,
  baseCost: 500,
  unlockLevel: 5,
  effect: (level) => `Sell price: +${level * 10}%`
}
};

const ACHIEVEMENTS = {
harvester: {
  name: 'Harvester',
  description: 'Harvest crops',
  icon: 'üßë‚Äçüåæ',
  levels: [10, 50, 100, 500, 1000],
  rewards: [20, 50, 100, 500, 1000]
},
richFarmer: {
  name: 'Rich Farmer',
  description: 'Earn gold',
  icon: 'üí∞',
  levels: [100, 500, 1000, 5000, 10000],
  rewards: [20, 50, 100, 500, 1000]
},
builder: {
  name: 'Builder',
  description: 'Upgrade buildings',
  icon: 'üë∑',
  levels: [1, 5, 10, 15, 20],
  rewards: [20, 50, 100, 500, 1000]
},
farmer: {
  name: 'Farmer',
  description: 'Plant crops',
  icon: 'üöú',
  levels: [10, 50, 100, 500, 1000],
  rewards: [20, 50, 100, 500, 1000]
}
};

// Sound effects
const SOUNDS = {
click: 'data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA/+NAwAAAAAAAAAAAAFhpbmcAAAAPAAAAAwAAA3YAlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaWlpaW8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw////////////////////////////////////////////AAAAAExhdmM1OC4xMwAAAAAAAAAAAAAAACQDQAAAAAAAAN2UR8DzAAAAAAAAAAAAAAAAAAAAAP/jYMQAEvgiwl/AAAAAAQ8DHBkOGBkhkOD4nBwMHRgfBAIPgg+CDDYPg+D5/wQfB8Hw/lHyT5J8IQhP/BIQj/yX5P8m+IPh8EAAAAAIBgGAYBgAAAAAAGAYBgAAAAAQDAAAwDAMAAwDAAA0BAIBwTAcGQ0TgcSwcCQoC4IhwFx4QjBCP//////////////////////////9A6Cgg//8IDA4JhQKBgAAAAABAgKAgICAgICAgICAgICAgICAgICAgP/jaMQAGMpFgJfmBCTARgJAUAZDKDJJIILnXJJJJIRERERBEREQ7u7u7MzMzMzMzCIiIiIiIoiIiIiIiIxERERERERBEREQiIiIiIiIiIiIiIiIgwMDAwMDBAQEBDAwMDAwMEBAQEMDAwQEBAQEId3d3REREREcREREYiIiIiIiIiIiIiIiIiIiIiIiIiIhERERERERERERERERERERERJJJJJIgICAgICAgICAgICAgICAgAg',
plant: 'data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA/+NAwAAAAAAAAAAAAFhpbmcAAAAPAAAABwAACZAAEhISEhISQkJCQkJCYmJiYmJicHBwcHBwkJCQkJCQrq6urq6uvLy8vLy8zMzMzMzM3Nzc3Nzc8vLy8vLy////////////AAAAAExhdmM1OC4xMwAAAAAAAAAAAAAAACQCQAAAAAAAAAmQ2L89JAAAAAAAAAAAAAAAAAAAAP/jaMQAEegxtH+0AAQ2BYKgUAgAAwPgeDUiIQGP4Pg+D4+P/5CEHx8fH//8fHwQdBwEI//+gEYIPj4+P//4+Pj49A/B8AAABBCEIP////wQCDknB0dErOTjEvtgRXxVdDcsIgHAA0QAgBACDr//KAgEwTBwYDryZJJWVqytMatyle9tLFxRWPHBEBAtYn0p3bjSpe83Kz2NXlqyuHxaGR//lMrpSSSVTkQERFWCbxAsDjyQqAgICkiMiOZElI3b7v///////4VkokREVJJXKlJXKpV/85U1OEoZL//Mrkkkrn/+XOpIiDBUEHP/+Unbvqqomd3d//+TuVrAuQVKqqv/jcMQ6L9XG7ysoAW+bmbO9qOl0ry9LtQxfm70qlS7lre1C5rdb1K3rWW96a3utb1rLepatLW7rWr0q1S65e9VVYqdKu9S9Se3NbnqTC3W96KlSXovTXoU6a1K3qTFwpi4VZcKbmhSlStLrW61XptTpvQxcKYuFMXCmGLvXCmFTWpWlzW63vQxcMXDF0IaNalSt6rW96NUngoaGhS6qvoQsaVK3oYuFMXCmGLkzW9NjQ0IS6lIZrU0rXehiakNC3WthDWn/5w0w0w0w0wqza67ZKt60VXCtONCHLktONCkM0IcuS040KQzQhy5LTjQwrThphy5LTjQpDNCHLktONCkM0IcuS040MK04aYchw4tHDVBYAEU0PQmaH5j4//x////g+Hw//////////ouYVIABERAiIiESIrANuDh4dLHRtFNcJZEdjOHOJrxwQGhoaAkBoaGhQxIZg4SGgJCgoYAkNCQ4ZY0NhQgcIGDDgyQMmhrTRKCpK//jgMQaK4PnEyyvAAhRMyO1hAMOoBxwgYMNDQ3QBKgnDgVwXhOHArhQXGMTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ',
harvest: 'data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA/+NAwAAAAAAAAAAAAFhpbmcAAAAPAAAACAAACcoAFhYWFhYWJycnJycnNzc3Nzc3SEhISEhIWFhYWFhYaWlpaWlpe3t7e3t7jIyMjIyMnJycnJyc/////////////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAAIAAAJyAASEhISEhISEiAgICAgICAgMDAwMDAwMDBAQEBAQEBAQFBQUFBQUFBQYGBgYGBgYGBwcHBwcHBwcICAgICAgICAkJCQkJCQkJCgoKCgoKCgoLCwsLCwsLCwwMDAwMDAwMDQ0NDQ0NDQ0ODg4ODg4ODg8PDw8PDw8PD/AAAAAExhdmM1OC4xMgAAAAAAAAAAAAAAACQCQAAAAAAAAAAAAAAAAAAAAAAAAAD/40DEACIGLRVzBgAIJAbfydAAAAAQCAIAiCIAAABhRBBBE888gAJsCATYPj44IPj44EOQAgE/BA5wQCDg+DnwQ8HwQcEAgGfA+CB//ghwQcHydoQcHB88EHQR6CBzgIPj5/BB8EIDwQc/CB8gEHIAgE/wQfgAgc/BAIPyfJHxE8AAwQ8EAhzwQDPweAkGAxMKBgmLx4mJtxpndGrSSRs5pDMJzmjWTSNjObtZNJIzmmTSNjObtZNI2M0yV7KVbNIZnN2UkjYzTJXspVGxnF22q8tEgAiP//+G3//w2//////CPDfDf//4b4b4bwz/ClK8N8NlsjX/40LEOzBmHLIwzODQI64jdGxnNMaYxGGqf//yRhRdMYjDVf//wGAwCAwp//lg3//8MCBA3//+MYxGMul4b//+G8N//8N4b4bw3///hvDf//8N8N8NlsjYzehV//8mSQ2M5pk0jYzm7aTSRs5pk0JBNkABSR//+SML//yRhDf/+G+G+G+G///hvhvhvhvDf//8N8NLj8yuY+G+G///wjwx/41DEODJlrLLQzNjcPAGMSGa+N//y4b4b4a//+BQKBQKuGyNiVGRsZzTGmMRhzS4Z///BwcHBhb/+TFkZGS3//+G+G+G+G///w3w3//8N8NlsjYzekbGc0rqRsZzRGGqGBwYZLhvhvhvhvhvhvhvDf//8N8N8Oj//////AwcHQwCAQjf/wODg4MP/5MRIRDj4b4b/jQMQmLqYcuufLAnwmKKMxgY4M5IxEwYzGSAyUCLilQO0jBQgMGCAwwCDzXIMBAFYUKVgYEIgDPQDIQRQh3QVqAOlgKCIAURQWi2QDBAdjhhvG8YEKMaPIaDhXxnggJjyRBGVoNSDFlzFWBHiXOMcB4MF1HFSMMRoQtQjzQVgxBZayiOAxwygvTHDMGIeI1AFFjRFKgWNMZBLIzhWQd85wdhjiJi3Cf/40LEJjRNxdi5u9G9jxn5pAFiZwKLmpEeaEBpp+JivUb7brJmZkizBCpI0gNljCIS3aYth/1xQk1q6x2011//4qaaaaanZoppppqaaaaadmimmmkFpttNCE000gW0eimatYobvHmZfWrOz1JeEev5we6sFd64U+W5YXFw+DRhjfn743tGOWgPVX3DSuUvcvyyuL84//1dVVVTSq//0rLgpSH//lKlZpTuqq//yQpVLSVQ3//kmSSasrmkr//5WVzkxBTUUzLjEw/jUMQULSWcyYe70SRVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV',
upgrade: 'data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA/+NAwAAAAAAAAAAAAFhpbmcAAAAPAAAAEwAAEJYAGBgYLi4uLS0tRUVFQUFBUlJSUFBQYmJiYGBgcnJyb29vgICAfX19jY2NioqKnJycmpqapqamnp6er6+vraGhoaCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKAAAAAASW5mbwAAAA8AAAMJAACSAAB+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+AAAAAExhdmM1OC4xMwAAAAAAAAAAAAAAACQDQAAAAAAAABCW38W6/gAAAAAAAAAAAAAAAAAAAAD/42DEAAAEgAWvIAAEwmDIdswMCAAZAAdBwa4UOu6DoQAgC+D4Jhzgg4IAxMfH8EHwQA+D4PggOcHwfHwQgg5wcHwfBB8EHB8Hw+CAYHODg5wffgM+ffHx8E99/+DhxAIBgQchzkJ48BW5IpEwskEDEwQGBhEEHGBMgUbdkCxgOQxmEQidGCHAe//jYMQpL4Ns0W8jYOwPGAIg4YIsT5g8IQmDBx0MChU0KUjQSsOAgESEERgEDIvCMEhzCQgfDiAA8YOGszudIGQQgNhYCYnAOYCQYNGFQCaJCYbDREEQSqkFQkyFGfo2/ROMlC0Ixj4DL9GqAQLOEA0FQI5JlyivE0CRIgnRMDBgaC7VBUCpLsFRVBnmR2S0iQEAUlogGQ5SqPYNeJzMODQ9c8SR+LCQA2KhGIpl1O+lhQCEgXCwDHV9YMIhYZsEYdC0xONjodqyMpUJEDiRHQpLIKinT1IkQMowpHcEIx5giHw//DJKQ4Jxm//jYMTYL+fk+WsfNkjO8sZpkK4FglgAJwgwhE0koL3MVKgCBvTH2+sHhUDwl45zU+l627aogkzlygUMDhDL7qrZ1UZq5xPSKXwVnfpPDQWxw6XV9yuIAcBdmpr8ug7i0NSkZloa8JfBgCAsAQFpcYMIMQACXcne2ESAQKEACD5hDjgZZUSJCH/Jy5CEiVGQlRKsbbihOACkxAkKtyH2/o0IEPwkRUlS5j/Fc+pGoqERhCAoISebVv/S8yp9Aj04srFRyNNKfQiYmpf93z////N////7////n9OLSu1KuVNLf9BuGfYQQBGIUZHCEyAKC5LIYOouECJT/42DE8DiZVLgAwoSVXxC8rpmc5RGv6/+X9/+JMVSkXTIXKhRi6qqqVSo/+MrHvmVQvN4SPzf8sZ+UkfeKnOrjNzkZ1W1FJ0MG3+pjweDzpIrAxaGQVsoZQJBGCTIoZT9+Ry+ny5IVImiRQRi6TzcpsXnLssj835TExOc2MVSYaTd90T56MTEIiIiIiIiIiIREiERERERIiRERECIREwNKxKRkpsQnZOS4hOD78KTleP3YmJy+7oiImJiIGnh95BcRomOP/jYMT7LOR8uAcQJHh4Ynw88ggav4uXFxcN35cXJTh6ceQ9POSjDlCc6cgrOVHk5wXOC45csVAvrgZd+q9q32XXX3cyMgwrbdbdalVLUOaqJ3332eypp62/6/WA9eAAAAQiRgR9JJZzIkZHydv7b8c3/633YE2gMDPxMRi42Nyc+PtrixBMbO3NnZm/6rVnZMh5mZkzMzP/+Zi3MzdzZnJvy5c5e6trBjEpP/MoE1DEQMICkCFQJsADJTVye0MoDh4oQJUZECIwKAnEEdBSCCYQ2rsOBgWFBQg//jYMUDLnlEuQDCA3SVAYIIhYCzxsAhq9j9nooDxULAGYGBQaA4FZQ5OAggaS0Gh7t7AO3JX6/Wslx4HBoGJqvR9KTQHiwcGhaYKJCAtdCwgBASAkAAoCBADU7AwDdwYonQdHn/9b61uNBAQjgFEhQEOYYEuChtrKb/+x79bnuGwMIVFTgxRXNyuP/7at6ytmVHgcvjooIiwaC0YEAwN/+1NAgQs1X1/sHhwxZosjFYoG2MHv8a//IXqGIIIPG4eSDINBZTUDtpnUFXBSsKC0ZLjD/42DE9y6jLLmywwLvFYgQFmYoClBTpwJVIbbWT9KlQ8oAKUtVFD1AcSJhsipAsSEg4rxOlJMhKXKqVM1Tn0ep5h9eScnjgv/9f/+lWvXpV9alhHrkVAwNG4anGG6HYf0v+T/pJRJRYWAEBhESLHREQUkV/z//o/UpJVJU7AIAAtEQGkIIRKRSQvP////9a1IXGSEI4JCMqUj/////9upqbm3VjSFQiNEiKRTK9JarX9S1/X6tTVrvv1pVKpUqmpqanpr3Xa6/5STLuH3IXu2LSiWnc//jYMUTL3QctLDCBXVISGfKRYcpGldWBSlIpJSMoaJOLycp+f+5WO5pc+WSuUiNLz4QDEonl5PVqkWnIJnpTjuoxUxBTUUzLjEwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV',
achievement: 'data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA/+NAwAAAAAAAAAAAAFhpbmcAAAAPAAAAFwAAHwQAEhISEhIiIiIiIiIyMjIyMjJCQkJCQkJSUlJSUlJiYmJiYmJycnJycnKCgoKCgoKSkpKSkpKioqKioqKysrKysrLCwsLCwsLS0tLS0tLi4uLi4uLy8vLy8vICAgICAgL/AAAAAExhdmM1OC4xMwAAAAAAAAAAAAAAACQEQAAAAAAAAB8E59kneQAAAAAAAAAAAAAAAAAAAP/jYMQAELmncP2BgBBwc4ID4wOQAXBznBznBdBwd8HB8fBwc///B/5CIPD/Lg58Hz/wcHB8/f+CAYC5B8EIPnwfBB/BB//BB/BB8//ggEC5wHO5///s+CgLpyflxwTDDwwxAOB8TBGJQXopUy7mEkFKTKCHQqGTSEJJp0K7tJNLJpZNKGbS5m0skylZNKgzabmbSsmmS63W62W9XuMARJMupoC4GOhiGFxnEpJMmk0mlk0iCYUubdZLJp0Kh/jYMQtK+ORB7yyAAlRqhtgYYSMk0svJtLJpSd3d3d2GRFDLQ7u7u8MiGTJFRSSSSCkkkkSQyKSRZWVmZlllZlZXREWVBifYXRcYYYWZZZZXi4uLDDC4vGHi4vF0XJJJBckkmngAQju7u7u7oiIiJGGRDJu7ukRERFXERCkREQn4lVz8JJEhHArhONxOFcTjcJwrhOE4+HArhXE4nE4ThOLofJ8oCk4Pw8Hwf0JKa9ET/88whx8m799dRldcq//7VKH/42DEOTODYss9u8AAmp1MiVX///KZU7iqcpTyPFUqv//4XR8HRQiUSiUSn//8pVf//LhlciNTK5Ea//+WOILzGAwMDAwMDcyA4JQnBv//yYxMY4zhMYxjP//wxjGMPjT//+JjGMYxjGGxjGMYbGMYxhsYT7GEKSkpKSkpUlJSUn/5KjSUlRpKSmkpKaR///8lJTSVGkpKVAsLhYKQrCwoBCwsKBSQsKBS//+qqqqqq1VVVVVqqnL//4aqhqsNVVSqqqpqqGqw1UN//qqqqqqr//mVVUNVDeGqqqqqqrDVUNVVVVVVVVVVVVVVVVVVVVVVVVVVXiYmpX/42DEJSpTNsvsEAQAVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV',
error: 'data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA/+NAwAAAAAAAAAAAAFhpbmcAAAAPAAAAEwAACaAAGhsbGxsbMTExMTExR0dHR0dHXFxcXFxcc3NzcXFxi4uLi4uLoqKioqKipaWlurq6u7u709PT09PT5ubm5ubm9PT09PT0//////////8AAAAAExlifgAAAAAAAAAAAAAAAAAAAAAAAExhdmM1OC4xMwAAAAAAAAAAAAAAACQLkAAAAAAAAAmmYGR1GgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/jYMQAEvQANLcDAAA/gCAILkvgjB/8EOcHB8Hz4PPnB8H4IOCD//gg+fBBzg/yCcHwf/8HB//+D7+CAYIOCDnB//BB8EHBiD4Px8IQiEQPnzgg5wQcHwfHwQcE+D8EH8HO58HB8fx8Pj//cWCRIYRIULEgJF2FfgMU97TmuqgkBdrrADgQHt9zPcrt3WsN1qYDldu61hjd1gBw3db3Nc17fW9YbgZ+5nEy5nud1tYbrVwNjMJlaGMYxhu3dbu62HoefBn6Ca9xnDdayDGb99zPB8+DHt9zUoGk4GMZw3dYAcN3WAHDZ++5mQQXu8H/jYMQiL2X8lQCjAQAgAYzwKrjDDJ426XF0XCuE8J4ThQCrqtd22Z3YyazuaJwrkvF8J4l26YZ3dlu2I8SZMlcXcvF8K5dwiOzs7NChEEMQQ7N02zuOqruV1dUtMXCeJ4ThRZZhmnj/////////nET1QIhLlcK5LEROzZJ2YZly8XwrhOE4ThOy2hTwn//////aJwnc4Twni7lYu5eLuUqqzGdxnZ2dn////////chQiQpEOEcJ4rheL4ThOE7Mzu7M7Mz9XLgRQoUJ3QoQpQoV4u5eLuXBF3Lv/jYMQxLqQksSSzwAFHbpq2YZp9ndiJFCr////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////jYMRJIwAO0AQwAAf////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//jYMRJIwAO0AQwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//jYMRJIwAO0AQwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'
};

// Game State
let gameState = {
gold: 100,
crops: 0,
energy: 10,
maxEnergy: 10,
lastEnergyRegen: Date.now(),
level: 1,
xp: 0,
xpToNextLevel: 100,
plots: [],
buildings: {},
achievements: {},
stats: {
  cropsSold: 0,
  cropsHarvested: 0,
  goldEarned: 0,
  cropsPlanted: 0,
  buildingsUpgraded: 0
},
lastSaved: Date.now(),
initialized: false,
soundEnabled: true
};

// DOM Elements
const goldValueElement = document.getElementById('gold-value');
const cropsValueElement = document.getElementById('crops-value');
const energyValueElement = document.getElementById('energy-value');
const levelValueElement = document.getElementById('level-value');
const farmPlotsElement = document.getElementById('farm-plots');
const seedsContainerElement = document.getElementById('seeds-container');
const buildingsContainerElement = document.getElementById('buildings-container');
const marketContainerElement = document.getElementById('market-container');
const achievementsContainerElement = document.getElementById('achievements-container');
const notificationContainerElement = document.getElementById('notification-container');
const confettiContainerElement = document.getElementById('confetti-container');
const modalOverlay = document.getElementById('modal');
const modalTitle = document.getElementById('modal-title');
const modalBody = document.getElementById('modal-body');
const modalCloseButton = document.getElementById('modal-close');
const modalCancelButton = document.getElementById('modal-cancel');
const modalConfirmButton = document.getElementById('modal-confirm');
const soundToggle = document.getElementById('sound-toggle');

// Audio elements
const audioElements = {};

// Initialize audio elements
function initAudio() {
for (const [key, src] of Object.entries(SOUNDS)) {
  audioElements[key] = new Audio(src);
  audioElements[key].volume = 0.3;
}

soundToggle.addEventListener('click', toggleSound);
}

// Toggle sound
function toggleSound() {
gameState.soundEnabled = !gameState.soundEnabled;
if (gameState.soundEnabled) {
  soundToggle.innerHTML = '<span>üîä</span>';
  soundToggle.classList.remove('muted');
} else {
  soundToggle.innerHTML = '<span>üîà</span>';
  soundToggle.classList.add('muted');
}
saveGame();
}

// Play sound
function playSound(sound) {
if (gameState.soundEnabled && audioElements[sound]) {
  // Stop and reset the sound before playing again
  audioElements[sound].pause();
  audioElements[sound].currentTime = 0;
  audioElements[sound].play().catch(e => console.error('Error playing sound:', e));
}
}

// Game Functions

// Initialize the game
function initGame() {
loadGame();

if (!gameState.initialized) {
  // First time setup
  for (let i = 0; i < 9; i++) {
    gameState.plots.push({
      index: i,
      status: 'empty',
      plantedTime: null,
      seedType: null
    });
  }
  
  // Initialize buildings
  Object.keys(BUILDINGS).forEach(buildingId => {
    gameState.buildings[buildingId] = {
      level: 0,
      unlocked: gameState.level >= BUILDINGS[buildingId].unlockLevel
    };
  });
  
  // Initialize achievements
  Object.keys(ACHIEVEMENTS).forEach(achievementId => {
    gameState.achievements[achievementId] = {
      progress: 0,
      level: 0,
      claimed: []
    };
  });
  
  gameState.initialized = true;
  saveGame();
}

initAudio();
renderUI();
setupEventListeners();
startGameLoop();

// Show welcome notification on first load
if (gameState.lastSaved === Date.now()) {
  showNotification('Welcome to Pocket Empire Builder!', 'Start by planting some crops in your farm.', 'info');
}

// Add first-time user tutorial
if (gameState.lastSaved === Date.now()) {
  setTimeout(() => {
    showTutorial();
  }, 1500);
}
}

// Show tutorial for new players
function showTutorial() {
modalTitle.textContent = 'Welcome to Your Farm!';
modalBody.innerHTML = `
  <div style="text-align: center; margin-bottom: 1.5rem;">
    <div style="font-size: 2.5rem; margin-bottom: 1rem;">üå±</div>
    <h3 style="margin-bottom: 0.5rem;">How to Play</h3>
    <p>Welcome to your pocket farm empire! Let me show you how to get started:</p>
  </div>
  <div style="margin-bottom: 1rem;">
    <p><strong>1. Plant Crops:</strong> Click on an empty plot to plant seeds.</p>
    <p><strong>2. Harvest:</strong> When crops are ready, click to harvest them.</p>
    <p><strong>3. Sell Crops:</strong> Go to the Market tab to sell your crops for gold.</p>
    <p><strong>4. Upgrade:</strong> Use gold to upgrade your buildings for better production.</p>
  </div>
  <div>
    <p>Your energy regenerates over time, so plan your farming wisely!</p>
    <p style="text-align: center; margin-top: 1rem; font-weight: bold; color: var(--primary-dark);">Good luck, farmer!</p>
  </div>
`;

modalConfirmButton.style.display = 'block';
modalConfirmButton.textContent = 'Let\'s Start!';
modalCancelButton.style.display = 'none';

modalOverlay.style.display = 'flex';

modalConfirmButton.onclick = () => {
  modalOverlay.style.display = 'none';
  showNotification('First Steps', 'Click on an empty plot to plant your first crop!', 'info');
};
}

// Save game state to localStorage
function saveGame() {
gameState.lastSaved = Date.now();
try {
  localStorage.setItem(SAVE_KEY, JSON.stringify(gameState));
  console.log('Game saved successfully');
} catch (error) {
  console.error('Error saving game:', error);
  showNotification('Save Error', 'Could not save your game progress.', 'error');
}
}

// Load game state from localStorage
function loadGame() {
try {
  const savedGame = localStorage.getItem(SAVE_KEY);
  if (savedGame) {
    const loadedState = JSON.parse(savedGame);
    // Merge saved state with default state to ensure we have all properties
    gameState = { ...gameState, ...loadedState };
    console.log('Game loaded successfully');
    
    // Calculate offline progress
    if (gameState.lastSaved) {
      calculateOfflineProgress(Date.now() - gameState.lastSaved);
    }
  }
} catch (error) {
  console.error('Error loading game:', error);
  showNotification('Load Error', 'Could not load your saved game.', 'error');
}
}

// Calculate progress while player was away
function calculateOfflineProgress(timePassed) {
if (timePassed < 5000) return; // Less than 5 seconds, ignore

let notification = 'While you were away:';
let changes = false;

// Energy regeneration
const energyGained = Math.min(
  gameState.maxEnergy - gameState.energy,
  Math.floor(timePassed / ENERGY_REGEN_TIME)
);
if (energyGained > 0) {
  gameState.energy += energyGained;
  notification += `\n+${energyGained} energy regenerated`;
  changes = true;
}

// Update last energy regen time
gameState.lastEnergyRegen = Date.now() - (timePassed % ENERGY_REGEN_TIME);

// Crop growth and harvesting
gameState.plots.forEach(plot => {
  if (plot.status === 'planted' && plot.plantedTime) {
    const growthTime = SEED_TYPES[plot.seedType].growthTime;
    const timeElapsed = timePassed + (Date.now() - plot.plantedTime);
    
    if (timeElapsed >= growthTime) {
      plot.status = 'ready';
      changes = true;
    }
  }
});

// Building production
if (gameState.buildings.barn && gameState.buildings.barn.level > 0) {
  const productionRate = gameState.buildings.barn.level; // crops per minute
  const cropsProduced = Math.floor(productionRate * timePassed / 60000);
  
  if (cropsProduced > 0) {
    addCrops(cropsProduced);
    notification += `\n+${cropsProduced} crops from barn production`;
    changes = true;
  }
}

if (changes) {
  showNotification('Welcome Back!', notification, 'info');
}
}

// Main game loop
function startGameLoop() {
// Update timers every second
setInterval(() => {
  updateTimers();
  renderResources();
}, 1000);

// Auto-save game
setInterval(() => {
  saveGame();
}, AUTO_SAVE_INTERVAL);

// Regenerate energy
setInterval(() => {
  regenerateEnergy();
}, 10000); // Check every 10 seconds
}

// Update all timers (plots, energy, etc.)
function updateTimers() {
// Update plot growth timers
gameState.plots.forEach((plot, index) => {
  if (plot.status === 'planted' && plot.plantedTime) {
    const seed = SEED_TYPES[plot.seedType];
    const growthTime = seed.growthTime;
    const timeElapsed = Date.now() - plot.plantedTime;
    
    // Update progress bar if there's one
    const plotElement = document.querySelector(`.plot[data-index="${index}"]`);
    if (plotElement) {
      const progressBar = plotElement.querySelector('.progress-bar');
      if (progressBar) {
        const progress = Math.min(100, (timeElapsed / growthTime) * 100);
        progressBar.style.width = `${progress}%`;
      }
    }
    
    if (timeElapsed >= growthTime) {
      plot.status = 'ready';
      renderPlot(index);
      showNotification('Crops Ready!', `Your ${seed.name} is ready to harvest!`, 'success');
    }
  }
});

// Passive income from buildings
if (gameState.buildings.barn && gameState.buildings.barn.level > 0) {
  // Every full minute
  if (Math.floor(Date.now() / 60000) > Math.floor(gameState.lastSaved / 60000)) {
    const production = gameState.buildings.barn.level;
    addCrops(production);
  }
}
}

// Regenerate energy over time
function regenerateEnergy() {
if (gameState.energy < gameState.maxEnergy) {
  const now = Date.now();
  const timeSinceLastRegen = now - gameState.lastEnergyRegen;
  
  if (timeSinceLastRegen >= ENERGY_REGEN_TIME) {
    const energyToAdd = Math.min(
      Math.floor(timeSinceLastRegen / ENERGY_REGEN_TIME),
      gameState.maxEnergy - gameState.energy
    );
    
    gameState.energy += energyToAdd;
    gameState.lastEnergyRegen = now - (timeSinceLastRegen % ENERGY_REGEN_TIME);
    
    renderResources();
  }
}
}

// Resource Management
function addGold(amount) {
gameState.gold += amount;
gameState.stats.goldEarned += amount;
checkAchievements('richFarmer', gameState.stats.goldEarned);
animateResourceValue(goldValueElement);
renderResources();
}

function spendGold(amount) {
if (gameState.gold >= amount) {
  gameState.gold -= amount;
  animateResourceValue(goldValueElement);
  renderResources();
  return true;
}
return false;
}

function addCrops(amount) {
gameState.crops += amount;
animateResourceValue(cropsValueElement);
renderResources();
}

function spendCrops(amount) {
if (gameState.crops >= amount) {
  gameState.crops -= amount;
  animateResourceValue(cropsValueElement);
  renderResources();
  return true;
}
return false;
}

function useEnergy(amount) {
if (gameState.energy >= amount) {
  gameState.energy -= amount;
  animateResourceValue(energyValueElement);
  renderResources();
  return true;
}
return false;
}

function animateResourceValue(element) {
element.classList.add('updated');
setTimeout(() => {
  element.classList.remove('updated');
}, 500);
}

function addXP(amount) {
gameState.xp += amount;

while (gameState.xp >= gameState.xpToNextLevel) {
  gameState.xp -= gameState.xpToNextLevel;
  gameState.level++;
  gameState.xpToNextLevel = Math.floor(gameState.xpToNextLevel * 1.5);
  
  showNotification('Level Up!', `Congratulations! You reached level ${gameState.level}!`, 'success');
  animateResourceValue(levelValueElement);
  createConfetti(30);
  playSound('achievement');
  
  // Unlock new features based on level
  checkUnlocks();
}

renderResources();
}

// Check for new unlocks based on level
function checkUnlocks() {
// Check for building unlocks
Object.keys(BUILDINGS).forEach(buildingId => {
  const building = BUILDINGS[buildingId];
  if (gameState.level >= building.unlockLevel && (!gameState.buildings[buildingId] || !gameState.buildings[buildingId].unlocked)) {
    if (!gameState.buildings[buildingId]) {
      gameState.buildings[buildingId] = { level: 0, unlocked: true };
    } else {
      gameState.buildings[buildingId].unlocked = true;
    }
    showNotification('New Building Unlocked!', `You've unlocked the ${building.name}!`, 'info');
  }
});

// Render buildings to show new unlocks
renderBuildings();

// Render seeds to show new unlocks
renderSeeds();
}

// Achievement System
function checkAchievements(type, value) {
if (!gameState.achievements[type]) return;

const achievement = gameState.achievements[type];
achievement.progress = value;

const levels = ACHIEVEMENTS[type].levels;
const currentLevel = achievement.level;

// Check if we've reached a new level
let newLevel = currentLevel;
while (newLevel < levels.length && value >= levels[newLevel]) {
  newLevel++;
}

if (newLevel > currentLevel) {
  achievement.level = newLevel;
  
  // Show notification for each level gained
  for (let i = currentLevel + 1; i <= newLevel; i++) {
    if (!achievement.claimed.includes(i - 1)) {
      showNotification(
        'Achievement Unlocked!',
        `${ACHIEVEMENTS[type].name} Level ${i}! Claim your reward!`,
        'success'
      );
      createConfetti(20);
      playSound('achievement');
    }
  }
  
  renderAchievements();
}
}

function claimAchievementReward(type, level) {
const achievement = gameState.achievements[type];
if (achievement.level >= level + 1 && !achievement.claimed.includes(level)) {
  const reward = ACHIEVEMENTS[type].rewards[level];
  addGold(reward);
  achievement.claimed.push(level);
  showNotification('Reward Claimed!', `You received ${reward} gold!`, 'success');
  createConfetti(15);
  playSound('achievement');
  renderAchievements();
  return true;
}
return false;
}

// UI Rendering Functions
function renderUI() {
renderResources();
renderPlots();
renderSeeds();
renderBuildings();
renderMarket();
renderAchievements();
}

function renderResources() {
goldValueElement.textContent = gameState.gold;
cropsValueElement.textContent = gameState.crops;
energyValueElement.textContent = `${gameState.energy}/${gameState.maxEnergy}`;
levelValueElement.textContent = gameState.level;
}

function renderPlots() {
farmPlotsElement.innerHTML = '';

gameState.plots.forEach((plot, index) => {
  const plotElement = document.createElement('div');
  plotElement.className = `plot ${plot.status}`;
  plotElement.dataset.index = index;
  
  let content = '';
  let overlayContent = '';
  
  switch (plot.status) {
    case 'empty':
      content = 'üèûÔ∏è';
      overlayContent = 'Plant';
      break;
    case 'planted':
      const seed = SEED_TYPES[plot.seedType];
      const timeElapsed = Date.now() - plot.plantedTime;
      const progress = Math.min(100, (timeElapsed / seed.growthTime) * 100);
      
      content = seed.icon;
      // Add progress bar
      content += `<div class="progress-container" style="position: absolute; bottom: 5px; left: 5px; right: 5px;">
                    <div class="progress-bar" style="width: ${progress}%"></div>
                  </div>`;
      overlayContent = formatTime(seed.growthTime - timeElapsed);
      break;
    case 'ready':
      content = SEED_TYPES[plot.seedType].icon;
      overlayContent = 'Harvest';
      plotElement.classList.add('pulse');
      break;
  }
  
  plotElement.innerHTML = `
    ${content}
    <div class="plot-overlay">
      <span>${overlayContent}</span>
    </div>
  `;
  
  plotElement.addEventListener('click', () => handlePlotClick(index));
  farmPlotsElement.appendChild(plotElement);
});
}

function renderPlot(index) {
const plotElements = document.querySelectorAll('.plot');
if (index < plotElements.length) {
  const plot = gameState.plots[index];
  const plotElement = plotElements[index];
  
  // Update class
  plotElement.className = `plot ${plot.status}`;
  
  let content = '';
  let overlayContent = '';
  
  switch (plot.status) {
    case 'empty':
      content = 'üèûÔ∏è';
      overlayContent = 'Plant';
      break;
    case 'planted':
      const seed = SEED_TYPES[plot.seedType];
      const timeElapsed = Date.now() - plot.plantedTime;
      const progress = Math.min(100, (timeElapsed / seed.growthTime) * 100);
      
      content = seed.icon;
      // Add progress bar
      content += `<div class="progress-container" style="position: absolute; bottom: 5px; left: 5px; right: 5px;">
                    <div class="progress-bar" style="width: ${progress}%"></div>
                  </div>`;
      overlayContent = formatTime(seed.growthTime - timeElapsed);
      break;
    case 'ready':
      content = SEED_TYPES[plot.seedType].icon;
      overlayContent = 'Harvest';
      plotElement.classList.add('pulse');
      break;
  }
  
  plotElement.innerHTML = `
    ${content}
    <div class="plot-overlay">
      <span>${overlayContent}</span>
    </div>
  `;
}
}

function renderSeeds() {
seedsContainerElement.innerHTML = '';

Object.keys(SEED_TYPES).forEach(seedId => {
  const seed = SEED_TYPES[seedId];
  
  // Only show seeds that the player has unlocked
  if (gameState.level >= seed.unlockLevel) {
    const seedElement = document.createElement('div');
    seedElement.className = 'building-item';
    
    seedElement.innerHTML = `
      <div class="building-header">
        <span class="building-title">${seed.icon} ${seed.name}</span>
      </div>
      <div class="building-description">Grows in ${formatTime(seed.growthTime)}</div>
      <div class="building-production">Yield: ${seed.yield} crops</div>
      <div class="building-cost">
        <span class="cost-item">
          <span>üí∞</span> ${seed.cost}
        </span>
        <span class="tooltip">
          <span class="cost-item">
            <span>‚ö°</span> 1
          </span>
          <span class="tooltip-text">Requires 1 energy to plant</span>
        </span>
      </div>
      <button class="btn btn-block" data-seed="${seedId}">Plant (${seed.cost} gold)</button>
    `;
    
    const plantButton = seedElement.querySelector('button');
    plantButton.addEventListener('click', () => handleSeedSelect(seedId));
    
    if (gameState.gold < seed.cost || gameState.energy < 1) {
      plantButton.classList.add('btn-disabled');
    }
    
    seedsContainerElement.appendChild(seedElement);
  }
});
}

function renderBuildings() {
buildingsContainerElement.innerHTML = '';

Object.keys(BUILDINGS).forEach(buildingId => {
  const building = BUILDINGS[buildingId];
  const userBuilding = gameState.buildings[buildingId] || { level: 0, unlocked: false };
  
  // Only show buildings that the player has unlocked
  if (userBuilding.unlocked) {
    const buildingElement = document.createElement('div');
    buildingElement.className = 'building-item';
    
    const nextLevel = userBuilding.level + 1;
    const isMaxLevel = userBuilding.level >= building.maxLevel;
    const upgradeCost = Math.floor(building.baseCost * Math.pow(1.5, userBuilding.level));
    
    buildingElement.innerHTML = `
      <div class="building-header">
        <span class="building-title">${building.icon} ${building.name}</span>
        <span class="building-level">Level ${userBuilding.level}</span>
      </div>
      <div class="building-description">${building.description}</div>
      <div class="building-production">${building.effect(userBuilding.level)}</div>
      ${!isMaxLevel ? `
        <div class="building-cost">
          <span class="cost-item">
            <span>üí∞</span> ${upgradeCost}
          </span>
        </div>
        <div class="building-production">Next level: ${building.effect(nextLevel)}</div>
        <button class="btn btn-block" data-building="${buildingId}">Upgrade (${upgradeCost} gold)</button>
      ` : `
        <div class="building-cost">
          <span class="cost-item">Maximum level reached</span>
        </div>
        <button class="btn btn-block btn-disabled">Maxed Out</button>
      `}
    `;
    
    if (!isMaxLevel) {
      const upgradeButton = buildingElement.querySelector('button');
      upgradeButton.addEventListener('click', () => handleBuildingUpgrade(buildingId));
      
      if (gameState.gold < upgradeCost) {
        upgradeButton.classList.add('btn-disabled');
      }
    }
    
    buildingsContainerElement.appendChild(buildingElement);
  }
});
}

function renderMarket() {
marketContainerElement.innerHTML = '';

const sellElement = document.createElement('div');
sellElement.className = 'building-item';

// Calculate sell price with windmill bonus
const windmillLevel = gameState.buildings.windmill ? gameState.buildings.windmill.level : 0;
const sellBonus = 1 + (windmillLevel * 0.1); // 10% per level
const sellPrice = Math.floor(2 * sellBonus); // Base price is 2 gold per crop

sellElement.innerHTML = `
  <div class="building-header">
    <span class="building-title">üåæ Sell Crops</span>
  </div>
  <div class="building-description">Sell your crops for gold</div>
  <div class="building-production">Current price: ${sellPrice} gold per crop</div>
  <div class="tooltip">
    <span class="cost-item">
      <span>üè≠</span> Windmill bonus: +${windmillLevel * 10}%
    </span>
    <span class="tooltip-text">Upgrade your windmill to increase selling prices</span>
  </div>
  <div style="margin-top: 1rem;">
    <label for="sell-amount">Amount to sell: <span id="sell-amount-value">${Math.min(10, gameState.crops)}</span> crops</label>
    <div class="progress-container" style="height: 15px; margin: 0.75rem 0;">
      <input type="range" id="sell-amount" min="1" max="${gameState.crops}" value="${Math.min(10, gameState.crops)}" style="width: 100%; position: absolute; top: 0; left: 0; opacity: 0; height: 100%; cursor: pointer; z-index: 2;" />
      <div class="progress-bar" style="width: ${Math.min(100, (Math.min(10, gameState.crops) / gameState.crops) * 100)}%"></div>
    </div>
    <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
      <span>1</span>
      <span>${gameState.crops}</span>
    </div>
    <button class="btn btn-block" id="sell-button">Sell ${Math.min(10, gameState.crops)} Crops for ${Math.min(10, gameState.crops) * sellPrice} Gold</button>
  </div>
`;

marketContainerElement.appendChild(sellElement);

// Set up sell slider
const sellAmountInput = document.getElementById('sell-amount');
const sellAmountValue = document.getElementById('sell-amount-value');
const sellButton = document.getElementById('sell-button');
const progressBar = sellElement.querySelector('.progress-bar');

sellAmountInput.addEventListener('input', () => {
  const amount = parseInt(sellAmountInput.value);
  sellAmountValue.textContent = amount;
  progressBar.style.width = `${Math.min(100, (amount / gameState.crops) * 100)}%`;
  sellButton.textContent = `Sell ${amount} Crops for ${amount * sellPrice} Gold`;
});

sellButton.addEventListener('click', () => {
  const amount = parseInt(sellAmountInput.value);
  if (amount > 0 && amount <= gameState.crops) {
    spendCrops(amount);
    const goldEarned = amount * sellPrice;
    addGold(goldEarned);
    gameState.stats.cropsSold += amount;
    showNotification('Crops Sold!', `You sold ${amount} crops for ${goldEarned} gold!`, 'success');
    playSound('click');
    createCoinEffect(sellButton, goldEarned);
    renderMarket();
  } else {
    playSound('error');
  }
});

// Disable button if no crops
if (gameState.crops === 0) {
  sellButton.classList.add('btn-disabled');
  sellAmountInput.disabled = true;
}
}

function renderAchievements() {
achievementsContainerElement.innerHTML = '';

Object.keys(ACHIEVEMENTS).forEach(achievementId => {
  const achievement = ACHIEVEMENTS[achievementId];
  const userProgress = gameState.achievements[achievementId] || { progress: 0, level: 0, claimed: [] };
  
  for (let i = 0; i < achievement.levels.length; i++) {
    const level = i;
    const target = achievement.levels[level];
    const completed = userProgress.progress >= target;
    const claimed = userProgress.claimed.includes(level);
    const canClaim = completed && !claimed;
    
    const achievementElement = document.createElement('div');
    achievementElement.className = `achievement ${completed ? 'completed' : ''}`;
    
    const progressPercent = Math.min(100, (userProgress.progress / target) * 100);
    
    achievementElement.innerHTML = `
      <div class="achievement-icon">${achievement.icon}</div>
      <div class="achievement-info">
        <div class="achievement-title">${achievement.name} ${level + 1}</div>
        <div class="achievement-desc">${achievement.description} (${userProgress.progress}/${target})</div>
        <div class="progress-container">
          <div class="progress-bar" style="width: ${progressPercent}%"></div>
        </div>
      </div>
      <div class="achievement-progress">
        ${canClaim ? `
          <button class="btn claim-reward" data-type="${achievementId}" data-level="${level}">
            Claim ${achievement.rewards[level]} üí∞
          </button>
        ` : claimed ? `
          <span style="color: var(--success)">Claimed</span>
        ` : `
          <span>${Math.floor(progressPercent)}%</span>
        `}
      </div>
    `;
    
    if (canClaim) {
      const claimButton = achievementElement.querySelector('.claim-reward');
      claimButton.addEventListener('click', () => {
        claimAchievementReward(achievementId, level);
      });
    }
    
    achievementsContainerElement.appendChild(achievementElement);
  }
});
}

// Event Handlers
function setupEventListeners() {
// Tab switching
const tabs = document.querySelectorAll('.tab');
tabs.forEach(tab => {
  tab.addEventListener('click', () => {
    playSound('click');
    tabs.forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    
    const tabContents = document.querySelectorAll('.tab-content');
    tabContents.forEach(content => content.classList.remove('active'));
    
    const tabName = tab.dataset.tab;
    const activeContent = document.getElementById(tabName);
    activeContent.classList.add('active');
    activeContent.classList.add('fade-in');
    setTimeout(() => activeContent.classList.remove('fade-in'), 300);
  });
});

// Modal close button
modalCloseButton.addEventListener('click', () => {
  playSound('click');
  modalOverlay.style.display = 'none';
});

// Modal cancel button
modalCancelButton.addEventListener('click', () => {
  playSound('click');
  modalOverlay.style.display = 'none';
});

// Save game when page is closed
window.addEventListener('beforeunload', () => {
  saveGame();
});

// Button to manually save game
document.addEventListener('keydown', (e) => {
  if (e.key === 's' && (e.ctrlKey || e.metaKey)) {
    e.preventDefault();
    saveGame();
    showNotification('Game Saved', 'Your progress has been saved.', 'info');
  }
});
}

function handlePlotClick(index) {
playSound('click');
const plot = gameState.plots[index];

switch (plot.status) {
  case 'empty':
    showSeedSelectionModal(index);
    break;
  case 'ready':
    harvestPlot(index);
    break;
  case 'planted':
    showPlotInfoModal(index);
    break;
}
}

function showSeedSelectionModal(plotIndex) {
modalTitle.textContent = 'Select Seed';
modalBody.innerHTML = '';

Object.keys(SEED_TYPES).forEach(seedId => {
  const seed = SEED_TYPES[seedId];
  
  // Only show seeds that the player has unlocked
  if (gameState.level >= seed.unlockLevel) {
    const seedElement = document.createElement('div');
    seedElement.className = 'building-item';
    
    seedElement.innerHTML = `
      <div class="building-header">
        <span class="building-title">${seed.icon} ${seed.name}</span>
      </div>
      <div class="building-description">Grows in ${formatTime(seed.growthTime)}</div>
      <div class="building-production">Yield: ${seed.yield} crops</div>
      <div class="building-cost">
        <span class="cost-item">
          <span>üí∞</span> ${seed.cost}
        </span>
        <span class="cost-item">
          <span>‚ö°</span> 1
        </span>
      </div>
      <button class="btn btn-block seed-select" data-seed="${seedId}">Plant (${seed.cost} gold)</button>
    `;
    
    const plantButton = seedElement.querySelector('.seed-select');
    
    if (gameState.gold < seed.cost || gameState.energy < 1) {
      plantButton.classList.add('btn-disabled');
    } else {
      plantButton.addEventListener('click', () => {
        plantSeed(plotIndex, seedId);
        modalOverlay.style.display = 'none';
      });
    }
    
    modalBody.appendChild(seedElement);
  }
});

modalConfirmButton.style.display = 'none';
modalCancelButton.textContent = 'Close';
modalOverlay.style.display = 'flex';
}

function showPlotInfoModal(plotIndex) {
const plot = gameState.plots[plotIndex];
const seed = SEED_TYPES[plot.seedType];

if (plot.status === 'planted') {
  const timeElapsed = Date.now() - plot.plantedTime;
  const timeRemaining = Math.max(0, seed.growthTime - timeElapsed);
  const progress = Math.min(100, (timeElapsed / seed.growthTime) * 100);
  
  modalTitle.textContent = `${seed.name} Growth`;
  modalBody.innerHTML = `
    <div style="text-align: center; margin-bottom: 1rem;">
      <div style="font-size: 3rem; margin-bottom: 0.5rem;">${seed.icon}</div>
      <h3>${seed.name}</h3>
    </div>
    <div class="progress-container" style="height: 20px; margin: 1.5rem 0;">
      <div class="progress-bar" style="width: ${progress}%"></div>
    </div>
    <p style="text-align: center; font-size: 1.1rem; margin-bottom: 1rem;">Growth: ${Math.floor(progress)}% complete</p>
    <p style="text-align: center;">Time remaining: <strong>${formatTime(timeRemaining)}</strong></p>
    <p style="text-align: center; margin-top: 0.5rem;">Expected yield: <strong>${seed.yield} crops</strong></p>
  `;
  
  modalConfirmButton.style.display = 'none';
  modalCancelButton.textContent = 'Close';
  modalOverlay.style.display = 'flex';
}
}

function handleSeedSelect(seedId) {
playSound('click');
if (gameState.energy < 1) {
  showNotification('Not Enough Energy', 'You need 1 energy to plant.', 'warning');
  playSound('error');
  return;
}

showSeedSelectionModal(-1);
}

function plantSeed(plotIndex, seedId) {
const seed = SEED_TYPES[seedId];

if (gameState.gold >= seed.cost && gameState.energy >= 1) {
  spendGold(seed.cost);
  useEnergy(1);
  
  gameState.plots[plotIndex] = {
    index: plotIndex,
    status: 'planted',
    plantedTime: Date.now(),
    seedType: seedId
  };
  
  gameState.stats.cropsPlanted++;
  checkAchievements('farmer', gameState.stats.cropsPlanted);
  
  renderPlot(plotIndex);
  playSound('plant');
  showNotification('Seed Planted!', `You planted ${seed.name}.`, 'success');
  
  // Save game after planting
  saveGame();
} else {
  if (gameState.gold < seed.cost) {
    showNotification('Not Enough Gold', `You need ${seed.cost} gold to plant this seed.`, 'warning');
    playSound('error');
  } else if (gameState.energy < 1) {
    showNotification('Not Enough Energy', 'You need 1 energy to plant.', 'warning');
    playSound('error');
  }
}
}

function harvestPlot(index) {
if (gameState.energy >= 1) {
  const plot = gameState.plots[index];
  const seed = SEED_TYPES[plot.seedType];
  
  useEnergy(1);
  addCrops(seed.yield);
  addXP(seed.xp);
  
  // Reset plot
  plot.status = 'empty';
  plot.plantedTime = null;
  plot.seedType = null;
  
  gameState.stats.cropsHarvested += seed.yield;
  checkAchievements('harvester', gameState.stats.cropsHarvested);
  
  renderPlot(index);
  playSound('harvest');
  showNotification('Harvest Complete!', `You harvested ${seed.yield} ${seed.name}.`, 'success');
  
  // Create crop particles
  createCropParticles(document.querySelector(`.plot[data-index="${index}"]`), seed.icon);
  
  // Save game after harvesting
  saveGame();
} else {
  showNotification('Not Enough Energy', 'You need 1 energy to harvest.', 'warning');
  playSound('error');
}
}

function handleBuildingUpgrade(buildingId) {
playSound('click');
const building = BUILDINGS[buildingId];
const userBuilding = gameState.buildings[buildingId];

if (userBuilding.level >= building.maxLevel) {
  showNotification('Max Level Reached', `${building.name} is already at maximum level.`, 'info');
  return;
}

const upgradeCost = Math.floor(building.baseCost * Math.pow(1.5, userBuilding.level));

if (gameState.gold >= upgradeCost) {
  spendGold(upgradeCost);
  userBuilding.level++;
  
  // Apply building effects
  applyBuildingEffects(buildingId);
  
  gameState.stats.buildingsUpgraded++;
  checkAchievements('builder', gameState.stats.buildingsUpgraded);
  
  renderBuildings();
  renderResources();
  
  playSound('upgrade');
  showNotification('Building Upgraded!', `${building.name} upgraded to level ${userBuilding.level}!`, 'success');
  createConfetti(15);
  
  // Save game after upgrading
  saveGame();
} else {
  showNotification('Not Enough Gold', `You need ${upgradeCost} gold to upgrade this building.`, 'warning');
  playSound('error');
}
}

function applyBuildingEffects(buildingId) {
const userBuilding = gameState.buildings[buildingId];

switch (buildingId) {
  case 'silo':
    // No direct effect, increases storage capacity in the future
    break;
  case 'well':
    // Increases max energy
    gameState.maxEnergy = 10 + (userBuilding.level * 2);
    break;
  case 'barn':
    // Passive crop generation (handled in updateTimers)
    break;
  case 'windmill':
    // Increases selling price (handled in market)
    renderMarket();
    break;
}
}

// Particle effects
function createConfetti(count) {
confettiContainerElement.innerHTML = '';

const colors = ['#9b87f5', '#7E69AB', '#4CAF50', '#FFC107', '#2196F3', '#F44336'];

for (let i = 0; i < count; i++) {
  const confetti = document.createElement('div');
  confetti.className = 'confetti';
  
  const size = Math.random() * 10 + 5; // 5-15px
  const color = colors[Math.floor(Math.random() * colors.length)];
  
  confetti.style.width = `${size}px`;
  confetti.style.height = `${size}px`;
  confetti.style.backgroundColor = color;
  confetti.style.left = `${Math.random() * 100}%`;
  confetti.style.animationDelay = `${Math.random() * 0.5}s`;
  confetti.style.animationDuration = `${Math.random() * 2 + 2}s`; // 2-4s
  
  // Random shapes
  if (Math.random() > 0.5) {
    confetti.style.borderRadius = '50%';
  } else if (Math.random() > 0.5) {
    confetti.style.borderRadius = '4px';
  } else {
    confetti.style.transform = 'rotate(45deg)';
  }
  
  confettiContainerElement.appendChild(confetti);
  
  // Remove confetti after animation
  setTimeout(() => {
    if (confetti.parentNode) {
      confetti.parentNode.removeChild(confetti);
    }
  }, 4000);
}
}

function createCropParticles(parentElement, cropIcon) {
const rect = parentElement.getBoundingClientRect();
const centerX = rect.left + rect.width / 2;
const centerY = rect.top + rect.height / 2;

for (let i = 0; i < 5; i++) {
  const particle = document.createElement('div');
  particle.textContent = cropIcon;
  particle.style.position = 'fixed';
  particle.style.left = `${centerX}px`;
  particle.style.top = `${centerY}px`;
  particle.style.fontSize = '1.5rem';
  particle.style.pointerEvents = 'none';
  particle.style.zIndex = '1000';
  particle.style.transition = 'all 1s cubic-bezier(0.23, 1, 0.32, 1)';
  
  document.body.appendChild(particle);
  
  // Trigger animation after a small delay to ensure transition works
  setTimeout(() => {
    const angle = Math.random() * Math.PI * 2;
    const distance = 50 + Math.random() * 50;
    const x = centerX + Math.cos(angle) * distance;
    const y = centerY + Math.sin(angle) * distance - 50;
    
    particle.style.transform = 'scale(1.5)';
    particle.style.opacity = '0';
    particle.style.left = `${x}px`;
    particle.style.top = `${y}px`;
    
    // Remove particle after animation
    setTimeout(() => {
      if (particle.parentNode) {
        particle.parentNode.removeChild(particle);
      }
    }, 1000);
  }, 10);
}
}

function createCoinEffect(buttonElement, amount) {
const rect = buttonElement.getBoundingClientRect();
const centerX = rect.left + rect.width / 2;
const centerY = rect.top + rect.height / 2;

for (let i = 0; i < Math.min(10, amount / 10); i++) {
  const coin = document.createElement('div');
  coin.textContent = 'üí∞';
  coin.style.position = 'fixed';
  coin.style.left = `${centerX}px`;
  coin.style.top = `${centerY}px`;
  coin.style.fontSize = '1.5rem';
  coin.style.pointerEvents = 'none';
  coin.style.zIndex = '1000';
  coin.style.transition = 'all 1s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
  
  document.body.appendChild(coin);
  
  // Trigger animation after a small delay
  setTimeout(() => {
    const goldValueRect = goldValueElement.getBoundingClientRect();
    const targetX = goldValueRect.left + goldValueRect.width / 2;
    const targetY = goldValueRect.top + goldValueRect.height / 2;
    
    coin.style.transform = 'scale(0.5)';
    coin.style.left = `${targetX}px`;
    coin.style.top = `${targetY}px`;
    
    // Remove coin after animation
    setTimeout(() => {
      if (coin.parentNode) {
        coin.parentNode.removeChild(coin);
      }
    }, 1000);
  }, 10 + i * 100);
}
}

// Helper Functions
function formatTime(ms) {
if (ms < 60000) {
  return `${Math.ceil(ms / 1000)} seconds`;
} else {
  const minutes = Math.floor(ms / 60000);
  const seconds = Math.ceil((ms % 60000) / 1000);
  return `${minutes}m ${seconds}s`;
}
}

function showNotification(title, message, type = 'info') {
const notification = document.createElement('div');
notification.className = `notification ${type}`;
notification.innerHTML = `
  <div>
    <strong>${title}</strong>
    <p>${message}</p>
  </div>
  <button class="notification-close">&times;</button>
`;

notificationContainerElement.appendChild(notification);

// Show notification with animation
setTimeout(() => {
  notification.classList.add('show');
}, 10);

// Auto-hide after 5 seconds
setTimeout(() => {
  notification.classList.remove('show');
  setTimeout(() => {
    if (notification.parentNode) {
      notification.parentNode.removeChild(notification);
    }
  }, 300);
}, 5000);

// Close button
const closeButton = notification.querySelector('.notification-close');
closeButton.addEventListener('click', () => {
  notification.classList.remove('show');
  setTimeout(() => {
    if (notification.parentNode) {
      notification.parentNode.removeChild(notification);
    }
  }, 300);
});

// Play sound based on notification type
if (type === 'error') {
  playSound('error');
} else if (type === 'success') {
  playSound('click');
}
}

// Start the game
document.addEventListener('DOMContentLoaded', initGame);
</script>
</body>
</html>